digraph read_flac_residual {
  size="4,4.5";
  node [fontname="DejaVuSans"];
  edge [fontname="DejaVuSans"];
  ratio=fill;
  margin=0;

  init [shape=record,label="{input residual|input Rice}"];
  init -> check_sign;
  check_sign [shape=diamond,label="is\nresidual < 0?"];
  check_sign -> positive [label="NO"];
  check_sign -> negative [label="YES"];
  positive [shape=box,label="unsigned = residual × 2"];
  negative [shape=box,label="unsigned = (-residual × 2) + 1"];

  positive -> set_msb;
  negative -> set_msb;
  set_msb [shape=box,label="MSB = unsigned >> Rice"];
  set_msb -> set_lsb;
  set_lsb [shape=box,label="LSB = unsigned - MSB"];
  set_lsb -> check_msb_done;

  check_msb_done [shape=diamond,label="is\nMSB > 0?"];
  check_msb_done -> write_zero [label="YES"];
  write_zero [shape=parallelogram,label="write 1, 0"];
  write_zero -> decrement_msb;
  decrement_msb [shape=box,label="MSB = MSB - 1"];
  decrement_msb -> check_msb_done;
  check_msb_done -> write_one [label="NO"];
  write_one [shape=parallelogram,label="write 1, 1"];
  write_one -> write_lsb;
  write_lsb [shape=parallelogram,label="write Rice, LSB"];
  write_lsb -> done;
  done [shape=record,label="done"];

  label1 [shape=plaintext,label="append sign bit"];
  {rank=same; label1; positive; negative;};
  label2 [shape=plaintext,label="the Most Significant Bits"];
  {rank=same; label2; set_msb;};
  label3 [shape=plaintext,label="the Least Significant Bits"];
  {rank=same; label3; set_lsb;};
  label4 [shape=plaintext,label="write MSB as unary value"];
  {rank=same; label4; write_zero; write_one};
  label5 [shape=plaintext,label="write LSB as-is"];
  {rank=same; label5; write_lsb;};
}
